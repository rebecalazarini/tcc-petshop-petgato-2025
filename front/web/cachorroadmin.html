<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Pet Gato</title>
    <style>
        /* Estilo do Header */
        header {
            text-align: center;
            margin-bottom: 20px;
        }

        /* Estilo para os bot√µes */
        .Containerheader button {
            margin: 10px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }

        /* Estilo dos Cards */
        .produtos-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            gap: 20px;
            margin-top: 20px;
        }

        .produto-card {
            width: 250px;
            padding: 20px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: transform 0.3s;
        }

        .produto-card img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 10px;
        }

        .produto-card h3 {
            font-size: 18px;
            margin: 10px 0;
        }

        .produto-card p {
            font-size: 14px;
            margin: 10px 0;
        }

        .produto-card .preco {
            font-size: 16px;
            font-weight: bold;
            color: #1c8e4b;
        }

        .produto-card:hover {
            transform: scale(1.05);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
        }

        .modal-content {
            background-color: #fff;
            margin: 10% auto;
            padding: 20px;
            border-radius: 8px;
            width: 50%;
            max-width: 400px;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: black;
        }
    </style>
</head>
<body>

<header>
    <h1>ùìüùìÆùìΩ ùìñùì™ùìΩùì∏</h1>
    <button onclick="window.location.href='admin.html'">
        Voltar para a tela inicial admin
    </button>
</header>

<div class="Containerheader">
    <button onclick="window.location.href='consulta.html'">
        Consulta
    </button>
    <button id="novoProdutoBtn">
        Novo Produto
    </button>
</div>

<!-- Produtos -->
<div id="produtosLista" class="produtos-container"></div>

<!-- Modal para cadastrar novo produto -->
<div id="novoProdutoModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <h2>Cadastrar Novo Produto</h2>
    <form id="produtoForm">
      <label for="nome">Nome do Produto:</label>
      <input type="text" id="nome" name="nome" required><br><br>
      
      <label for="descricao">Descri√ß√£o:</label>
      <textarea id="descricao" name="descricao" required></textarea><br><br>

      <label for="preco">Pre√ßo:</label>
      <input type="number" id="preco" name="preco" required><br><br>
      
      <label for="imagem">URL da Imagem:</label>
      <input type="url" id="imagem" name="imagem" placeholder="https://exemplo.com/imagem.jpg" required><br><br>
      
      <label for="categoria">Categoria:</label>
      <select id="categoria" name="categoria" required>
        <option value="cachorro">Cachorro</option>
        <option value="gato">Gato</option>
        <option value="outros">Outros</option>
        <option value="farmacia">Farm√°cia</option>
      </select><br><br>

      <button type="submit">Cadastrar Produto</button>
    </form>
  </div>
</div>

<script>
  // Chamada √† API para pegar os produtos
  fetch('http://localhost:3000/produto')
    .then(response => response.json())
    .then(produtos => {
      let produtosHTML = '';
      produtos.forEach(produto => {
        produtosHTML += `
          <div class="produto-card">
            <img src="${produto.imagem}" alt="${produto.nome}">
            <h3>${produto.nome}</h3>
            <p>${produto.descricao}</p>
            <p class="preco">R$ ${produto.preco}</p>
          </div>
        `;
      });
      document.getElementById('produtosLista').innerHTML = produtosHTML;
    })
    .catch(error => {
      console.error('Erro ao carregar os produtos:', error);
      document.getElementById('produtosLista').innerHTML = '<p>Erro ao carregar produtos. Tente novamente.</p>';
    });

  // Modal - abrir e fechar
  document.getElementById("novoProdutoBtn").onclick = function() {
    document.getElementById("novoProdutoModal").style.display = "block";
  };

  function closeModal() {
    document.getElementById("novoProdutoModal").style.display = "none";
  }

  // Submeter o formul√°rio
  document.getElementById("produtoForm").onsubmit = function(event) {
    event.preventDefault();

    const nome = document.getElementById("nome").value;
    const descricao = document.getElementById("descricao").value;
    const preco = document.getElementById("preco").value;
    const imagem = document.getElementById("imagem").value;
    const categoria = document.getElementById("categoria").value;  // Obter a categoria selecionada

    const produtoData = {
      nome: nome,             // Correspondente ao modelo de banco
      descricao: descricao,   // Correspondente ao modelo de banco
      preco: parseFloat(preco), // Convertendo para n√∫mero de ponto flutuante
      imagem: imagem,         // Correspondente ao modelo de banco
      categoria: categoria    // Enviar a categoria (novo campo)
    };

    // Enviar para as duas APIs
    const urlLocal = 'http://localhost:3000/produto';
    const urlVercel = 'https://back-end-tcc-gamma.vercel.app/produto';

    const requestLocal = fetch(urlLocal, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(produtoData),
    });

    const requestVercel = fetch(urlVercel, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(produtoData),
    });

    // Aguarde ambas as requisi√ß√µes serem resolvidas
    Promise.all([requestLocal, requestVercel])
      .then(responses => Promise.all(responses.map(response => response.json())))
      .then(data => {
        alert('Produto cadastrado com sucesso nas duas APIs!');
        closeModal();
        window.location.reload(); // Atualiza a p√°gina
      })
      .catch(error => {
        console.error('Erro ao cadastrar o produto:', error);
        alert('Erro ao cadastrar o produto. Tente novamente.');
      });
  };
</script>

</body>
</html>
